{% extends "base.html" %}
{% block content %}
{% load static %}
<div class="form-container form-segments">
    <img src="{% static 'img/logo_pl.png' %}" id="logo" alt="logo UAM" aria-hidden="true">

    <h1>Dodaj nowe wydarzenie</h1>
    <p>Wprowadź szczegóły wydarzenia poniżej, aby dodać nowe wydarzenie.</p>

    <form method="post" enctype="multipart/form-data">
        {% csrf_token %}

        <!-- Event Details Section -->
        <div class="form-form">
            <h2>Event Details</h2>
            <div class="input-box">
                <label for="event-name">Nazwa wydarzenia:</label>
                <input type="text" id="event-name" name="eventname" placeholder="Enter event name" required>
            </div>
            <div class="input-box">
                <label for="event-description">Opis:</label>
                <textarea id="event-description" name="eventdescription" placeholder="Enter event description" required></textarea>
            </div>
            <div class="input-box">
                <label for="event-date-start">Start wydarzenia:</label>
                <input type="datetime-local" id="event-date-start" name="eventdatestart" required>
            </div>
            <div class="input-box">
                <label for="event-date-end">Koniec Wydarzenia:</label>
                <input type="datetime-local" id="event-date-end" name="eventdateend" required>
            </div>
            <div class="input-box">
                <label for="event-logo">Logo:</label>
                <input type="file" id="event-logo" name="eventlogo" accept="image/*">
            </div>
            <div class="input-box">
                <label for="id_organizer">Organizator:</label>
                <select id="id_organizer" name="segmentuser[]" multiple required>
                    {% for user in users %}
                        <option value="{{ user.id }}">{{ user.first_name }} {{ user.last_name }} ({{ user.user_type }})</option>
                    {% endfor %}
                </select>
            </div>
            <div class="input-box">
                <label for="event-groups">Grupy:</label>
                <select id="event-groups" name="eventgroups[]" multiple>
                    {% for group in groups %}
                        <option value="{{ group.id }}">{{ group.name }}</option>
                    {% endfor %}
                </select>
            </div>
        </div>

        <!-- Meetings Section -->
        <div id="segments-container">
            <h2>Spotkania</h2>
            <!-- Dynamic meeting segments will be appended here -->
        </div>
        <button type="button" id="add-segment-btn" class="form-button">Dodaj Spotkanie</button>
        <button type="submit" class="form-button">Akceptuj</button>
    </form>
</div>

<script>
document.getElementById('add-segment-btn').addEventListener('click', function () {
    const segmentsContainer = document.getElementById('segments-container');
    const segmentCount = segmentsContainer.children.length + 1;

    const newSegment = document.createElement('div');
    newSegment.classList.add('form-form', 'segment');

    newSegment.innerHTML = `
        <h3>Meeting ${segmentCount}</h3>
        <div class="input-box">
            <label for="segment-name-${segmentCount}">Nazwa Spotkania:</label>
            <input type="text" id="segment-name-${segmentCount}" name="segmentname[]" required>
        </div>
        <div class="input-box">
            <label for="segment-description-${segmentCount}">Opis:</label>
            <textarea id="segment-description-${segmentCount}" name="segmentdescription[]" required></textarea>
        </div>
        <div class="input-box">
            <label for="segment-room-${segmentCount}">Pomieszczenie:</label>
            <select id="segment-room-${segmentCount}" name="segmentroom[]" required>
                {% for room in rooms %}
                <option value="{{ room.id }}">Room {{ room.room_number }} ({{ room.building_name_pl }})</option>
                {% endfor %}
            </select>
        </div>
        <div class="input-box">
            <label for="segment-date-${segmentCount}">Data:</label>
            <input type="date" id="segment-date-${segmentCount}" name="segmentdate[]" required>
        </div>
        <div class="input-box">
            <label for="segment-time-start-${segmentCount}">Poczatek:</label>
            <input type="time" id="segment-time-start-${segmentCount}" name="segmenttimestart[]" required>
        </div>
        <div class="input-box">
            <label for="segment-time-end-${segmentCount}">Zakonczenie:</label>
            <input type="time" id="segment-time-end-${segmentCount}" name="segmenttimeend[]" required>
        </div>
        <div class="input-box">
            <label for="segment-participants-${segmentCount}">Liczba uczestnikow:</label>
            <input type="number" id="segment-participants-${segmentCount}" name="segmentparticipants[]" min="1" required>
        </div>
    `;

    segmentsContainer.appendChild(newSegment);
});
</script>
{% endblock content %}
